<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>MikroTik Advanced Queue & Traffic Shaping - Md. Jobaer Hossain</title>

  <link href="assets/img/favicon.png" rel="icon">

  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/css/main.css" rel="stylesheet">

  <style>
    .blog-details .content-wrapper {
      background-color: var(--surface-color);
      padding: 60px 50px;
      border-radius: 15px;
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.05);
      margin-top: -80px;
      position: relative;
      z-index: 10;
    }
    .blog-details .post-meta {
      color: color-mix(in srgb, var(--default-color), transparent 40%);
      font-size: 14px;
      margin-bottom: 25px;
      border-bottom: 1px solid color-mix(in srgb, var(--default-color), transparent 90%);
      padding-bottom: 15px;
    }
    .blog-details .post-meta i { color: var(--accent-color); margin-right: 5px; }
    .blog-details .content h2 { font-size: 28px; margin-top: 45px; font-weight: 700; color: var(--heading-color); border-left: 4px solid var(--accent-color); padding-left: 15px; }
    .blog-details .content h3 { font-size: 28px; margin-top: 45px; font-weight: 700; color: var(--heading-color); border-left: 4px solid var(--accent-color); padding-left: 15px; }
    .blog-details .content p { line-height: 1.8; margin-bottom: 20px; text-align: justify; }
    .blog-details .content blockquote {
      border-left: 5px solid var(--accent-color);
      padding: 30px;
      background: color-mix(in srgb, var(--default-color), transparent 97%);
      font-style: italic;
      margin: 40px 0;
      font-size: 1.1rem;
    }
    .tech-summary-box {
      background: color-mix(in srgb, var(--accent-color), transparent 92%);
      border: 1px solid var(--accent-color);
      padding: 30px;
      border-radius: 12px;
      margin: 40px 0;
    }
    .content ul li { margin-bottom: 12px; line-height: 1.6; }
    .code-block { background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; margin: 20px 0; overflow-x: auto; }
  </style>
</head>

<body class="index-page">

  <header id="header" class="header d-flex flex-column justify-content-center">
    <i class="header-toggle d-xl-none bi bi-list"></i>
    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="index.html#hero"><i class="bi bi-house navicon"></i><span>Home</span></a></li>
        <li><a href="index.html#about"><i class="bi bi-person navicon"></i><span>About</span></a></li>
        <li><a href="index.html#skills"><i class="bi bi-hammer navicon"></i><span>Skills</span></a></li>
        <li><a href="index.html#resume"><i class="bi bi-file-earmark-text navicon"></i><span>Resume</span></a></li>
        <li><a href="#blog" class="active"><i class="bi bi-journal-text navicon"></i><span>Blogs</span></a></li>
        <li><a href="index.html#services"><i class="bi bi-hdd-stack navicon"></i><span>Services</span></a></li>
        <li><a href="index.html#contact"><i class="bi bi-envelope navicon"></i><span>Contact</span></a></li>
      </ul>
    </nav>
  </header>

  <main class="main">

    <section class="page-title">
      <div class="container" data-aos="fade-up">
        <div class="mb-3">
          <a href="blogs.html" class="text-reset d-inline-flex align-items-center" style="text-decoration: none; opacity: 0.7; transition: 0.3s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.7">
            <i class="bi bi-chevron-left me-1"></i> Back to Blogs
          </a>
        </div>
        <h1>Technical Digest</h1>
      </div>
    </section>

    <section class="blog-details section">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-10" data-aos="fade-up">

            <div class="content-wrapper shadow-lg">
              <div class="post-meta">
                <span class="me-4"><i class="bi bi-person"></i> Md. Jobaer Hossain</span>
                <span class="me-4"><i class="bi bi-calendar"></i> Jan 22, 2026</span>
                <span class="me-4"><i class="bi bi-clock"></i> 15 Min Read</span>
              </div>

              <h2 class="mb-4" style="font-weight: 800; color: var(--heading-color);">MikroTik Advanced Queue & Traffic Shaping Guide</h2>
              
              <div class="content">
                <p>Bandwidth management is often the most misunderstood aspect of network administration. In a world where latency-sensitive applications like VoIP and gaming coexist with data-heavy backups, simple speed limits are no longer enough. This guide dives deep into MikroTik's Queue Tree and HTB (Hierarchical Token Bucket) to master traffic shaping.</p>

                <h3>1. Understanding the Packet Flow and Mangle</h3>
                <p>Before we can shape traffic, we must identify it. In MikroTik, this happens in the <strong>Mangle</strong> facility of the firewall. To perform advanced shaping, you must mark packets based on their protocol, port, or source/destination. For the most efficient results, always use <code>action=mark-connection</code> followed by <code>action=mark-packet</code>. This reduces CPU load significantly because the router only inspects the full packet header once per connection.</p>
                
                <p>The standard practice is to mark "heavy" traffic like YouTube or large file downloads separately from "interactive" traffic like DNS and HTTP-browsing to ensure high-priority packets are never queued behind a 4K video stream.</p>

                <h3>2. Queue Simple vs. Queue Tree</h3>
                <p>While <strong>Simple Queues</strong> are easier to configure and have become more efficient in recent RouterOS versions (v6 and v7), <strong>Queue Tree</strong> remains the gold standard for complex environments. Queue Tree allows for a true Hierarchical Token Bucket (HTB) structure, enabling bandwidth sharing between different branches of your network based on priority levels (1 through 8).</p>
                <ul>
                  <li><strong>Simple Queues:</strong> Processed in order. Good for individual client limits.</li>
                  <li><strong>Queue Tree:</strong> Global processing. Ideal for prioritizing specific service types (VoIP, Games, Web) across the entire user base.</li>
                </ul>

                <h3>3. The Hierarchical Token Bucket (HTB) Logic</h3>
                <p>HTB is the engine behind MikroTik's traffic shaping. It works on the concept of <strong>Limit-At</strong> (Guaranteed bandwidth) and <strong>Max-Limit</strong> (Burstable bandwidth). When the total traffic is below the parent limit, child queues can "borrow" unused bandwidth from the parent. This ensures that no bandwidth goes to waste while still protecting critical services.</p>
                
                <p>For example, if your total bandwidth is 100Mbps, you can guarantee 10Mbps for VoIP (Limit-At=10M). Even if the office is downloading at full speed, that 10Mbps is reserved exclusively for voice calls, preventing jitter and dropped packets.</p>

                <h3>4. PCQ (Per Connection Queuing) for Dynamic Balancing</h3>
                <p>One of MikroTik's most powerful features is <strong>PCQ</strong>. Instead of creating a queue for every single user, PCQ allows you to create one rule that automatically divides bandwidth equally among all active users. If one user is online, they get the full speed; if ten users are online, they each get 10%.</p>
                <div class="code-block">
                  /queue type add name="PCQ_download" kind=pcq pcq-rate=0 pcq-classifier=dst-address<br>
                  /queue type add name="PCQ_upload" kind=pcq pcq-rate=0 pcq-classifier=src-address
                </div>
                <p>Setting <code>pcq-rate=0</code> means the bandwidth is divided dynamically. Setting a value, like <code>pcq-rate=5M</code>, ensures no single user can ever exceed 5Mbps, regardless of total availability.</p>

                <h3>5. Bufferbloat and FQ-CoDel in RouterOS v7</h3>
                <p>A common issue in modern networks is <strong>Bufferbloat</strong>—where large buffers in networking equipment cause high latency. With RouterOS v7, MikroTik introduced <strong>Cake</strong> and <strong>FQ-CoDel</strong> (Fair Queuing Controlled Delay). These algorithms are designed to keep latency low even when the link is saturated. For home routers and small office environments, switching your queue type to FQ-CoDel can drastically improve the "feel" of the internet responsiveness.</p>

                <h3>6. Practical Configuration Steps</h3>
                <p>To implement a robust shaping policy, follow these steps:</p>
                <ul>
                  <li><strong>Step 1:</strong> Identify traffic in <code>/ip firewall mangle</code>. Mark connections, then mark packets.</li>
                  <li><strong>Step 2:</strong> Define Queue Types. Use PCQ for fair distribution.</li>
                  <li><strong>Step 3:</strong> Create the Queue Tree. Define a "Global" parent and sub-parents for Upload and Download.</li>
                  <li><strong>Step 4:</strong> Attach child queues to the sub-parents using the packet marks created in Step 1.</li>
                </ul>

                <div class="tech-summary-box">
                  <h3>⚠️ Best Practices for Traffic Shaping</h3>
                  <p>1. <strong>Don't Overcomplicate:</strong> Too many mangle rules will spike your CPU. Focus on the top 3-4 traffic types.</p>
                  <p>2. <strong>Set Realistic Max-Limits:</strong> Always set your Max-Limit slightly below your actual ISP speed (e.g., 95%) to ensure the router, not the ISP modem, controls the queue.</p>
                  <p>3. <strong>Monitor CPU:</strong> Advanced Queuing is CPU intensive. Check <code>/system resources</code> after applying changes.</p>
                  <hr>
                  <p class="mb-0"><strong>Summary:</strong> Mastering MikroTik Queues requires a deep understanding of packet flow and HTB. By combining Mangle, PCQ, and proper Priority settings, you can ensure a lag-free experience for your users even on congested links.</p>
                </div>
              </div>

              <div class="d-flex justify-content-between align-items-center mt-5">
                <a href="blogs.html" class="btn-resume-style"><i class="bi bi-arrow-left"></i> Back</a>
                <div class="social-links d-flex gap-3">
                   <a href="#" class="share-linkedin" style="color: var(--accent-color); font-size: 22px;"><i class="bi bi-linkedin"></i></a>
                   <a href="#" class="share-twitter" style="color: var(--accent-color); font-size: 22px;"><i class="bi bi-twitter-x"></i></a>
                   <a href="#" class="share-general" style="color: var(--accent-color); font-size: 22px;"><i class="bi bi-share"></i></a>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer id="footer" class="footer">
    <div class="container text-center">
      <div class="copyright">
        &copy; Copyright <strong><span>Jobaer Hossain</span></strong>. All Rights Reserved
      </div>
    </div>
  </footer>

  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/js/main.js"></script>
  <script>
    AOS.init({ duration: 1000, once: true });
  </script>

</body>
</html>